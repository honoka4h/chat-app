import{g as B,q as R,r as f,k as F,s as U,c as a,a as t,l as C,v as I,m as d,n as N,p as T,x as h,F as g,y as x,o as n,t as _}from"./CJ4QiOoU.js";import{u as A}from"./BxxLc4LK.js";import{l as M}from"./CA1CrNgP.js";import{u as b}from"./Q3TeS-oq.js";const S={class:"container p-4",style:{"max-width":"720px"}},j={style:{"margin-top":"18px"}},H={style:{"list-style":"none",padding:"0",margin:"0"}},V={class:"user-meta"},D={class:"user-name"},E={class:"user-actions"},P=["onClick"],z=["onClick"],L={key:0,class:"user-last",style:{padding:"8px 0",color:"var(--muted)"}},O={style:{"margin-top":"22px"}},Y={style:{"list-style":"none",padding:"0",margin:"0"}},Z={class:"user-avatar"},G=["src"],J={class:"user-meta"},K={class:"user-name"},Q={key:0,class:"user-last",style:{padding:"8px 0",color:"var(--muted)"}},re=B({__name:"index",setup(W){const o=R(),v=A(),i=M(`${o.public.apiBase}`,{withCredentials:!0});i.emit("registerUser",v.userid);const l=f([]),c=f("");function k(){i.emit("sendFriendRequest",{fromUserId:v.userid,toUserName:c.value}),c.value=""}function y(s,e){i.emit("respondFriendRequest",{requestId:s,accepted:e}),l.value=l.value.filter(r=>r.requestId!==s)}i.on("friendRequestSent",s=>{alert(`친구 요청을 ${s.toUserName}에게 보냈음`)}),i.on("friendRequestReceived",s=>{l.value.push(s)}),i.on("friendAccepted",s=>{alert(`${s.receiverid===v.userid?"상대방이":"너가"} 친구 요청을 수락했습니다.`)});async function w(){try{const{data:s,error:e}=await b(`${o.public.apiBase}/api/users/friendRequests`,{credentials:"include"},"$BsMcvBOoty");if(e.value){console.error("친구 요청 목록 불러오기 실패:",e.value);return}l.value=s.value?.requests?.map(r=>({requestId:r.id,fromUserId:r.senderid,fromUserName:r.sendername}))||[]}catch(s){console.error("HTTP 요청 에러:",s)}}const p=f([]);async function $(){try{const{data:s,error:e}=await b(`${o.public.apiBase}/api/users/friends`,{credentials:"include"},"$BH8tZ1ahYI");if(e.value){console.error("친구 목록 불러오기 실패:",e.value);return}p.value=s.value?.friends||[]}catch(s){console.error("HTTP 요청 에러:",s)}}const u=f({});async function q(s){if(u.value[s])return u.value[s];try{const r=await(await fetch(`${o.public.apiBase}/api/users/${s}/profile`)).json(),m=`${o.public.apiBase}/uploads/profiles/${r.profileImage}`;return u.value[s]=m,m}catch{const e=`${o.public.apiBase}/uploads/profiles/default-avatar.jpg`;return u.value[s]=e,e}}return F(()=>p.value,s=>{s.forEach(e=>{u.value[e.userid]||q(e.userid)})},{deep:!0}),U(()=>{$(),w()}),(s,e)=>(n(),a("div",S,[e[5]||(e[5]=t("h3",{class:"text-xl font-bold",style:{color:"var(--text)","margin-bottom":"12px"}},"친구 추가",-1)),t("form",{onSubmit:T(k,["prevent"]),class:"sidebar-search",style:{display:"flex",gap:"8px","margin-bottom":"16px"}},[C(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>N(c)?c.value=r:null),type:"text",placeholder:"친구의 사용자 이름","aria-label":"친구의 사용자 이름"},null,512),[[I,d(c)]]),e[1]||(e[1]=t("button",{type:"submit",class:"btn-primary"},"전송",-1))],32),t("section",j,[e[3]||(e[3]=t("h4",{style:{margin:"0 0 8px 0",color:"var(--text)","font-weight":"700"}},"받은 친구 요청",-1)),t("ul",H,[(n(!0),a(g,null,x(d(l),r=>(n(),a("li",{key:r.requestId,class:"user-item",style:{"justify-content":"space-between"}},[t("div",V,[t("div",D,_(r.fromUserName),1),e[2]||(e[2]=t("div",{class:"user-last",style:{"font-size":"12px"}},"요청을 보냈습니다.",-1))]),t("div",E,[t("button",{onClick:m=>y(r.requestId,!0),class:"btn",style:{background:"#16a34a",color:"white",padding:"6px 10px","border-radius":"8px"}},"수락",8,P),t("button",{onClick:m=>y(r.requestId,!1),class:"btn",style:{background:"#dc2626",color:"white",padding:"6px 10px","border-radius":"8px"}},"거절",8,z)])]))),128)),d(l).length===0?(n(),a("li",L,"받은 요청이 없습니다.")):h("",!0)])]),t("section",O,[e[4]||(e[4]=t("h4",{style:{margin:"0 0 8px 0",color:"var(--text)","font-weight":"700"}},"친구 목록",-1)),t("ul",Y,[(n(!0),a(g,null,x(d(p),r=>(n(),a("li",{key:r.userid,class:"user-item",style:{"align-items":"center"}},[t("div",Z,[t("img",{src:d(u)[r.userid],alt:"avatar"},null,8,G)]),t("div",J,[t("div",K,_(r.username),1)])]))),128)),d(p).length===0?(n(),a("li",Q,"친구가 없습니다.")):h("",!0)])])]))}});export{re as default};
