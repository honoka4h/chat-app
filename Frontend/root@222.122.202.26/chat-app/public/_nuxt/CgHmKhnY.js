/* empty css        */import{U as j}from"./DINi0mqw.js";import{_ as I}from"./BWHqMAqR.js";import{u as U}from"./BxxLc4LK.js";import{g as y,c as p,x as B,o as d,p as S,a as e,t as b,_ as R,r as _,j as w,I as P,b as v,m as C,q as V,k as L,s as N,J as A,F,y as M,w as O,d as T,G as q,K as D}from"./CJ4QiOoU.js";import{l as E}from"./CA1CrNgP.js";import{u as z}from"./Q3TeS-oq.js";const G={class:"popup-content"},H=y({__name:"ProfilePopup",props:{modelValue:{type:Boolean},username:{},bio:{}},emits:["update:modelValue","edit"],setup(m,{emit:a}){const o=a,n=()=>o("update:modelValue",!1),c=()=>o("edit");return(l,i)=>m.modelValue?(d(),p("div",{key:0,class:"popup-overlay",onClick:S(n,["self"])},[e("div",G,[e("h2",null,b(m.username),1),e("p",null,b(m.bio),1),e("button",{onClick:c},"프로필 수정"),e("button",{onClick:n},"닫기")])])):B("",!0)}}),J=Object.assign(R(H,[["__scopeId","data-v-55653d78"]]),{__name:"ProfilePopup"}),K={class:"user-info",role:"region","aria-label":"내 정보"},Q={class:"me",style:{display:"flex","align-items":"center",gap:"10px"}},W={class:"user-avatar"},X=["src"],Y=y({__name:"UserInfo",setup(m){const a=U(),o=V(),n=_(!1),c=w(),l=P(),i=_("");async function u(){if(a.userid)try{const r=await(await fetch(`${o.public.apiBase}/api/users/${a.userid}/profile`)).json();i.value=`${o.public.apiBase}/uploads/profiles/${r.profileImage}`}catch{i.value=`${o.public.apiBase}/uploads/profiles/default-avatar.jpg`}}u();async function x(){try{await $fetch(`${o.public.apiBase}/api/users/logout`,{method:"POST",credentials:"include"}),a.clearUser(),alert("로그아웃 되었습니다."),c.push("/")}catch(f){console.error(f),alert("로그아웃에 실패했습니다.")}}function $(){c.push({path:"/settings",query:{from:encodeURIComponent(l.fullPath)}})}return(f,r)=>(d(),p("div",K,[e("div",Q,[e("div",W,[e("img",{src:i.value,alt:"avatar"},null,8,X)]),e("div",null,[e("p",{onClick:r[0]||(r[0]=t=>n.value=!0),style:{cursor:"pointer",margin:"0",color:"var(--text)","font-weight":"700"}},b(C(a).username||"익명"),1),r[2]||(r[2]=e("p",{style:{margin:"0","font-size":"12px",color:"var(--muted)"}},"온라인",-1))])]),e("div",{style:{display:"flex",gap:"8px","align-items":"center"}},[e("button",{onClick:x,class:"btn",style:{padding:"6px 8px","border-radius":"8px",color:"var(--text)",background:"transparent"}},"로그아웃")]),v(J,{modelValue:n.value,"onUpdate:modelValue":r[1]||(r[1]=t=>n.value=t),username:C(a).username||"",bio:"자기소개가 없습니다.",onEdit:$},null,8,["modelValue","username"])]))}}),Z=Object.assign(Y,{__name:"UserInfo"}),ee={class:"user-list",role:"navigation","aria-label":"Direct messages"},te={class:"user-list-scroll"},se=["onClick"],oe={class:"user-avatar"},ae=["src"],ne={class:"user-meta"},re={class:"user-name"},ie={key:0,class:"user-last",style:{padding:"10px 0",color:"var(--muted)"}},le={class:"user-list-footer",style:{"margin-top":"12px",display:"flex",gap:"8px","flex-direction":"column"}},ue=y({__name:"UserList",setup(m){const a=U(),o=V(),n=w(),c=P(),l=E(`${o.public.apiBase}`,{withCredentials:!0}),i=_([]),u=_({});async function x(t){if(u.value[t])return u.value[t];try{const k=await(await fetch(`${o.public.apiBase}/api/users/${t}/profile`)).json(),g=`${o.public.apiBase}/uploads/profiles/${k.profileImage}`;return u.value[t]=g,g}catch{u.value[t]=`${o.public.apiBase}/uploads/profiles/default-avatar.jpg`;return}}L(i,t=>{t.forEach(s=>{u.value[s.userid]||x(s.userid)})},{deep:!0});async function $(){try{const{data:t,error:s}=await z(`${o.public.apiBase}/api/users/friends`,{credentials:"include"},"$S8s2_pUgU_");if(s.value){console.error("친구 목록 불러오기 실패:",s.value);return}i.value=t.value?.friends||[]}catch(t){console.error("HTTP 요청 에러:",t)}}function f(t){a.username&&(l.emit("joinRoom",{userIds:[a.userid,t]}),l.once("joinedRoom",s=>{n.push(`/chat/${s.roomId}`)}),l.once("error",s=>{console.error("socket error",s)}))}function r(){n.push({path:"/settings",query:{from:encodeURIComponent(c.fullPath)}})}return N(()=>{$()}),A(()=>{l.off("joinedRoom"),l.off("error")}),(t,s)=>{const k=I,g=Z;return d(),p("div",ee,[s[2]||(s[2]=e("h3",{style:{margin:"0 0 8px 0",color:"var(--text)"}},"다이렉트 메세지",-1)),e("div",te,[e("ul",null,[(d(!0),p(F,null,M(i.value,h=>(d(),p("li",{key:h.userid},[e("button",{class:"user-item",onClick:de=>f(h.userid)},[e("div",oe,[e("img",{src:u.value[h.userid],alt:"avatar"},null,8,ae)]),e("div",ne,[e("div",re,b(h.username),1),s[0]||(s[0]=e("div",{class:"user-last"},"대화 시작하기",-1))])],8,se)]))),128)),i.value.length===0?(d(),p("li",ie,"친구가 없습니다.")):B("",!0)])]),e("div",le,[v(k,{to:"/chat",class:"btn-outline",style:{"text-align":"center"}},{default:O(()=>[...s[1]||(s[1]=[T("친구 추가",-1)])]),_:1}),e("button",{class:"btn-outline",onClick:r},"설정"),v(g)])])}}}),ce=Object.assign(ue,{__name:"UserList"}),pe={class:"main-container"},ye=y({__name:"chat",setup(m){const a=_(!1);function o(){a.value=!a.value}return(n,c)=>(d(),p("div",pe,[v(j),e("button",{class:"mobile-toggle",onClick:o},"☰"),e("aside",{class:q({"mobile-open":a.value})},[v(ce)],2),e("main",null,[D(n.$slots,"default")])]))}});export{ye as default};
