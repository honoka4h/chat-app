import{_ as P}from"./CMWMu1Mi.js";import{_ as y}from"./Bu4Tso2Y.js";import{u as v}from"./CEY7yZKT.js";import{g as h,c as l,D as U,o as _,p as V,a as t,t as f,_ as w,j as b,r as $,b as p,m as d,n as B,q as x,k as j,F as I,x as S,w as L,d as N,E as R}from"./9hwllV1j.js";import{l as F}from"./CA1CrNgP.js";import{u as O}from"./DM7Yqy-E.js";const T={class:"popup-content"},D=h({__name:"ProfilePopup",props:{modelValue:{type:Boolean},username:{},bio:{}},emits:["update:modelValue","edit"],setup(i,{emit:s}){const a=s,e=()=>a("update:modelValue",!1),r=()=>a("edit");return(m,u)=>i.modelValue?(_(),l("div",{key:0,class:"popup-overlay",onClick:V(e,["self"])},[t("div",T,[t("h2",null,f(i.username),1),t("p",null,f(i.bio),1),t("button",{onClick:r},"프로필 수정"),t("button",{onClick:e},"닫기")])])):U("",!0)}}),E=Object.assign(w(D,[["__scopeId","data-v-55653d78"]]),{__name:"ProfilePopup"}),M={class:"user-info"},q=h({__name:"UserInfo",setup(i){const s=v();b();const a=x(),e=$(!1);async function r(){try{await $fetch(`${a.public.apiBase}/api/users/logout`,{method:"POST",credentials:"include"})&&(s.clearUser(),alert("로그아웃 되었습니다."))}catch(u){console.error(u),alert("로그아웃에 실패했습니다.")}}function m(){alert("프로필 수정 로직 넣어야 함")}return(u,c)=>(_(),l("div",M,[t("p",{onClick:c[0]||(c[0]=o=>e.value=!0),style:{cursor:"pointer"}},f(d(s).username)+" 님",1),t("button",{onClick:r},"로그아웃"),p(E,{modelValue:d(e),"onUpdate:modelValue":c[1]||(c[1]=o=>B(e)?e.value=o:null),username:d(s).username||"",bio:"자기소개가 없습니다.",onEdit:m},null,8,["modelValue","username"])]))}}),A=Object.assign(q,{__name:"UserInfo"}),H={class:"user-list"},z=["onClick"],G=h({__name:"UserList",setup(i){const s=b(),a=x(),e=v();$([]);const r=F(`${a.public.apiBase}`,{withCredentials:!0}),m=$([]);j(()=>e.username,async o=>{if(!o){s.push("/");return}await u()},{immediate:!0});async function u(){try{const{data:o,error:n}=await O(`${a.public.apiBase}/api/users/friends`,{credentials:"include"},"$S8s2_pUgU_");if(n.value){console.error("친구 목록 불러오기 실패:",n.value);return}m.value=o.value?.friends||[]}catch(o){console.error("HTTP 요청 에러:",o)}}function c(o){e.username&&(r.emit("joinRoom",{userIds:[e.userid,o]}),r.once("joinedRoom",n=>{s.push(`/chat/${n.roomId}`)}),r.once("error",n=>{console.error("socket error",n)}))}return(o,n)=>{const C=y,g=A;return _(),l("div",H,[n[1]||(n[1]=t("h3",null,"다이렉트 메세지",-1)),t("ul",null,[(_(!0),l(I,null,S(d(m),k=>(_(),l("li",{key:k.userid},[t("button",{onClick:Q=>c(k.userid)},f(k.username),9,z)]))),128))]),p(C,{to:"/"},{default:L(()=>[...n[0]||(n[0]=[N("친구 추가",-1)])]),_:1}),p(g)])}}}),J=Object.assign(G,{__name:"UserList"}),K={class:"main-container"},oe=h({__name:"chat",setup(i){return(s,a)=>{const e=P,r=J;return _(),l("div",K,[p(e),t("aside",null,[p(r)]),t("main",null,[R(s.$slots,"default")])])}}});export{oe as default};
