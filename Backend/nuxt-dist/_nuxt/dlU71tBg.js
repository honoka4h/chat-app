import{g as k,y,r as l,q as C,k as w,z as A,A as R,B as x,c,a as t,F as B,x as I,l as S,v as L,p as U,C as j,o as m,m as D,t as d}from"./9hwllV1j.js";import{l as T}from"./CA1CrNgP.js";import{u as z}from"./CEY7yZKT.js";const F=""+new URL("default-avatar.CGuCrbpz.jpg",import.meta.url).href,N={class:"chat-container"},V={class:"message-header"},q=["src"],E={class:"small"},K=k({__name:"[roomId]",setup(G){const p=j(),v=y(),g=C(),o=z(),f=Number(v.params.roomId),u=l([]),a=l(""),e=T(`${g.public.apiBase}`,{withCredentials:!0}),n=l(null);function h(){e.on("previousMessages",s=>{u.value=Array.isArray(s)?s:[]}),e.on("receiveMessage",s=>{u.value.push(s)}),e.on("roomMembers",s=>{console.log("room members:",s)})}function _(){o.userid&&(e.emit("joinRoom",{roomId:f,userId:o.userid}),h())}w(()=>o.userid,s=>{s?_():p.push("/")},{immediate:!0}),A(async()=>{await R(),n.value&&(n.value.scrollTop=n.value.scrollHeight)}),x(()=>{e.off("previousMessages"),e.off("receiveMessage"),e.off("roomMembers"),e.disconnect()});function M(){!a.value.trim()||!o.userid||(e.emit("sendMessage",{roomId:f,userId:o.userid,content:a.value}),a.value="")}return(s,i)=>(m(),c("div",N,[t("div",{class:"messages",ref_key:"messagesContainer",ref:n},[(m(!0),c(B,null,I(u.value,(r,b)=>(m(),c("div",{key:b,class:"message"},[t("div",V,[t("img",{class:"avatar",src:D(F),alt:"avatar"},null,8,q),t("strong",null,d(r.username),1),t("div",E,d(new Date(r.createdAt).toLocaleString()),1)]),t("div",null,d(r.content),1)]))),128))],512),t("form",{onSubmit:U(M,["prevent"]),class:"input-form"},[S(t("input",{"onUpdate:modelValue":i[0]||(i[0]=r=>a.value=r),placeholder:"메시지 입력..."},null,512),[[L,a.value]]),i[1]||(i[1]=t("button",{type:"submit"},"전송",-1))],32)]))}});export{K as default};
