import{g as k,q as w,r as c,s as _,c as a,a as r,l as B,v as U,m as p,n as $,p as F,F as v,x as b,o as u,t as g}from"./9hwllV1j.js";import{u as C}from"./CEY7yZKT.js";import{l as I}from"./CA1CrNgP.js";import{u as h}from"./DM7Yqy-E.js";const T={class:"p-4 space-y-4"},N={class:"mt-6"},M={class:"space-x-2"},S=["onClick"],H=["onClick"],A={class:"mt-6"},L=k({__name:"index",setup(D){const l=w(),d=C(),n=I(`${l.public.apiBase}`,{withCredentials:!0});n.emit("registerUser",d.userid);const o=c([]),i=c("");function x(){n.emit("sendFriendRequest",{fromUserId:d.userid,toUserName:i.value}),i.value=""}function f(s,e){n.emit("respondFriendRequest",{requestId:s,accepted:e}),o.value=o.value.filter(t=>t.requestId!==s)}n.on("friendRequestSent",s=>{alert(`친구 요청을 ${s.toUserName}에게 보냈음`)}),n.on("friendRequestReceived",s=>{o.value.push(s)}),n.on("friendAccepted",s=>{alert(`${s.receiverid===d.userid?"상대방이":"너가"} 친구 요청을 수락했습니다.`)});async function y(){try{const{data:s,error:e}=await h(`${l.public.apiBase}/api/users/friendRequests`,{credentials:"include"},"$BsMcvBOoty");if(e.value){console.error("친구 요청 목록 불러오기 실패:",e.value);return}o.value=s.value?.requests?.map(t=>({requestId:t.id,fromUserId:t.senderid,fromUserName:t.sendername}))||[]}catch(s){console.error("HTTP 요청 에러:",s)}}const m=c([]);async function q(){try{const{data:s,error:e}=await h(`${l.public.apiBase}/api/users/friends`,{credentials:"include"},"$BH8tZ1ahYI");if(e.value){console.error("친구 목록 불러오기 실패:",e.value);return}m.value=s.value?.friends||[]}catch(s){console.error("HTTP 요청 에러:",s)}}return _(()=>{q(),y()}),(s,e)=>(u(),a("div",T,[e[4]||(e[4]=r("h3",{class:"text-xl font-bold"},"친구 추가",-1)),r("form",{onSubmit:F(x,["prevent"]),class:"space-x-2"},[B(r("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>$(i)?i.value=t:null),placeholder:"친구의 사용자 이름",class:"border p-2 rounded bg-gray-800 text-white"},null,512),[[U,p(i)]]),e[1]||(e[1]=r("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"}," 보내기 ",-1))],32),r("div",N,[e[2]||(e[2]=r("h3",{class:"text-lg font-semibold mb-2"},"받은 친구 요청",-1)),r("ul",null,[(u(!0),a(v,null,b(p(o),t=>(u(),a("li",{key:t.requestId,class:"p-2 border-b border-gray-700 flex justify-between items-center"},[r("div",null,g(t.fromUserName)+" 님이 친구 요청을 보냈습니다. ",1),r("div",M,[r("button",{onClick:R=>f(t.requestId,!0),class:"bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700"}," 수락 ",8,S),r("button",{onClick:R=>f(t.requestId,!1),class:"bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700"}," 거절 ",8,H)])]))),128))])]),r("div",A,[e[3]||(e[3]=r("h3",{class:"text-lg font-semibold mb-2"},"친구 목록",-1)),r("ul",null,[(u(!0),a(v,null,b(p(m),t=>(u(),a("li",{key:t.userid,class:"p-2 border-b border-gray-700"},g(t.username),1))),128))])])]))}});export{L as default};
